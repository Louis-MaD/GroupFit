<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GroupFit - Find Your Workout Crew</title>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .message-bubble {
            animation: messagePop 0.2s ease-out;
        }
        @keyframes messagePop {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // IMPORTANT: Replace with your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAK2HWklg2t9L4h9ChKGqqOz3_c3JUlyaA",
            authDomain: "groupfit-f4cfc.firebaseapp.com",
            projectId: "groupfit-f4cfc",
            storageBucket: "groupfit-f4cfc.firebasestorage.app",
            messagingSenderId: "850906199498",
            appId: "1:850906199498:web:74d54df255cb83a6c9cb33",
            measurementId: "G-BN8F75BXYX"
        };

        // Initialize Firebase
        let db = null;
        let auth = null;
        let isFirebaseEnabled = false;

        // Check if Firebase config is provided
        if (firebaseConfig.apiKey !== "YOUR-API-KEY") {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                isFirebaseEnabled = true;
                console.log("‚úÖ Firebase initialized successfully!");
            } catch (error) {
                console.error("Firebase initialization error:", error);
                isFirebaseEnabled = false;
            }
        } else {
            console.warn("‚ö†Ô∏è Firebase not configured. Running in local mode. Sessions won't sync between users.");
        }

        const GroupFitApp = () => {
            // Authentication States
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [isSignUp, setIsSignUp] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            
            // App States
            const [sessions, setSessions] = useState([]);
            const [currentView, setCurrentView] = useState('home');
            const [userLocation, setUserLocation] = useState({ lat: 40.7128, lng: -74.0060, city: 'New York' });
            const [selectedSession, setSelectedSession] = useState(null);
            const [chats, setChats] = useState({});
            const [maxDistance, setMaxDistance] = useState(10);
            const [filterExercise, setFilterExercise] = useState('all');
            const [filterAgeRange, setFilterAgeRange] = useState({ min: 14, max: 19 });
            const [notifications, setNotifications] = useState([]);
            const [showSetupGuide, setShowSetupGuide] = useState(false);

            // Exercise Types
            const exerciseTypes = [
                { id: 'running', name: 'Running', icon: 'fa-running', color: 'bg-blue-500' },
                { id: 'swimming', name: 'Swimming', icon: 'fa-swimmer', color: 'bg-cyan-500' },
                { id: 'basketball', name: 'Basketball', icon: 'fa-basketball-ball', color: 'bg-orange-500' },
                { id: 'soccer', name: 'Soccer', icon: 'fa-futbol', color: 'bg-green-500' },
                { id: 'lifting', name: 'Weight Lifting', icon: 'fa-dumbbell', color: 'bg-purple-500' },
                { id: 'cycling', name: 'Cycling', icon: 'fa-bicycle', color: 'bg-yellow-500' },
                { id: 'yoga', name: 'Yoga', icon: 'fa-spa', color: 'bg-pink-500' },
                { id: 'tennis', name: 'Tennis', icon: 'fa-table-tennis', color: 'bg-red-500' },
                { id: 'volleyball', name: 'Volleyball', icon: 'fa-volleyball-ball', color: 'bg-indigo-500' },
                { id: 'hiking', name: 'Hiking', icon: 'fa-hiking', color: 'bg-green-600' }
            ];

            // Initialize and listen to Firebase data
            useEffect(() => {
                if (!isFirebaseEnabled) {
                    // Local storage fallback
                    const savedUser = localStorage.getItem('groupfit_current_user');
                    const savedSessions = localStorage.getItem('groupfit_sessions');
                    const savedChats = localStorage.getItem('groupfit_chats');
                    
                    if (savedUser) {
                        const user = JSON.parse(savedUser);
                        setCurrentUser(user);
                        setIsLoggedIn(true);
                    }
                    if (savedSessions) setSessions(JSON.parse(savedSessions));
                    if (savedChats) setChats(JSON.parse(savedChats));
                    setIsLoading(false);
                    return;
                }

                // Firebase auth listener
                const unsubscribeAuth = auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        // Get user data from Firestore
                        try {
                            const userDoc = await db.collection('users').doc(user.uid).get();
                            if (userDoc.exists) {
                                setCurrentUser({ id: user.uid, ...userDoc.data() });
                                setIsLoggedIn(true);
                                
                                // Load user's location
                                const userData = userDoc.data();
                                if (userData.location) {
                                    setUserLocation(userData.location);
                                }
                            }
                        } catch (error) {
                            console.error("Error fetching user data:", error);
                        }
                    } else {
                        setCurrentUser(null);
                        setIsLoggedIn(false);
                    }
                    setIsLoading(false);
                });

                // Real-time sessions listener
                let unsubscribeSessions = () => {};
                if (isFirebaseEnabled) {
                    unsubscribeSessions = db.collection('sessions')
                        .orderBy('createdAt', 'desc')
                        .onSnapshot((snapshot) => {
                            const sessionsData = [];
                            snapshot.forEach((doc) => {
                                sessionsData.push({ id: doc.id, ...doc.data() });
                            });
                            setSessions(sessionsData);
                        }, (error) => {
                            console.error("Error fetching sessions:", error);
                            showNotification("Error loading sessions. Please refresh.", 'error');
                        });
                }

                // Real-time chats listener
                let unsubscribeChats = () => {};
                if (isFirebaseEnabled) {
                    unsubscribeChats = db.collection('chats')
                        .onSnapshot((snapshot) => {
                            const chatsData = {};
                            snapshot.forEach((doc) => {
                                chatsData[doc.id] = doc.data().messages || [];
                            });
                            setChats(chatsData);
                        }, (error) => {
                            console.error("Error fetching chats:", error);
                        });
                }

                // Cleanup
                return () => {
                    unsubscribeAuth();
                    unsubscribeSessions();
                    unsubscribeChats();
                };
            }, []);

            // Save to localStorage when Firebase is not available
            useEffect(() => {
                if (!isFirebaseEnabled) {
                    if (currentUser) localStorage.setItem('groupfit_current_user', JSON.stringify(currentUser));
                    localStorage.setItem('groupfit_sessions', JSON.stringify(sessions));
                    localStorage.setItem('groupfit_chats', JSON.stringify(chats));
                }
            }, [currentUser, sessions, chats]);

            // Request geolocation
            useEffect(() => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const newLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                city: 'Current Location'
                            };
                            setUserLocation(newLocation);
                        },
                        (error) => {
                            console.log('Geolocation not available, using default location');
                        }
                    );
                }
            }, []);

            // Calculate distance between two coordinates
            const calculateDistance = (lat1, lon1, lat2, lon2) => {
                const R = 3959; // Earth's radius in miles
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                        Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            };

            // Show notification
            const showNotification = (message, type = 'info') => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, message, type }]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 3000);
            };

            // Filter sessions by distance and criteria
            const getFilteredSessions = () => {
                return sessions.filter(session => {
                    const distance = calculateDistance(
                        userLocation.lat, userLocation.lng,
                        session.location.lat, session.location.lng
                    );
                    const exerciseMatch = filterExercise === 'all' || session.exerciseType === filterExercise;
                    const ageMatch = session.ageRange.min <= filterAgeRange.max && 
                                     session.ageRange.max >= filterAgeRange.min;
                    const notFull = session.participants ? session.participants.length < session.maxParticipants : true;
                    const notPast = new Date(session.dateTime) > new Date();
                    
                    return distance <= maxDistance && exerciseMatch && ageMatch && notFull && notPast;
                });
            };

            // Firebase Setup Guide Modal
            const FirebaseSetupGuide = () => {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                        <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">Enable Online Sync (Firebase Setup)</h2>
                                <button onClick={() => setShowSetupGuide(false)} className="text-gray-500 hover:text-gray-700">
                                    <i className="fas fa-times text-2xl"></i>
                                </button>
                            </div>
                            
                            <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                                <p className="text-yellow-700">
                                    <i className="fas fa-info-circle mr-2"></i>
                                    Currently running in <strong>Local Mode</strong>. Sessions are only visible on your device.
                                </p>
                            </div>

                            <div className="prose max-w-none">
                                <h3 className="text-xl font-semibold mb-4">Quick Setup (10 minutes)</h3>
                                
                                <div className="space-y-6">
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h4 className="font-semibold text-lg mb-2">Step 1: Create Firebase Project</h4>
                                        <ol className="list-decimal list-inside space-y-2 text-sm">
                                            <li>Go to <a href="https://console.firebase.google.com" target="_blank" className="text-blue-600 underline">Firebase Console</a></li>
                                            <li>Click "Create a project" or "Add project"</li>
                                            <li>Name it "GroupFit" and continue</li>
                                            <li>Disable Google Analytics (not needed) and create project</li>
                                        </ol>
                                    </div>

                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h4 className="font-semibold text-lg mb-2">Step 2: Enable Authentication</h4>
                                        <ol className="list-decimal list-inside space-y-2 text-sm">
                                            <li>In Firebase Console, click "Authentication" in left menu</li>
                                            <li>Click "Get started"</li>
                                            <li>Choose "Email/Password" as sign-in method</li>
                                            <li>Enable the first toggle (Email/Password)</li>
                                            <li>Click "Save"</li>
                                        </ol>
                                    </div>

                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h4 className="font-semibold text-lg mb-2">Step 3: Create Database</h4>
                                        <ol className="list-decimal list-inside space-y-2 text-sm">
                                            <li>Click "Firestore Database" in left menu</li>
                                            <li>Click "Create database"</li>
                                            <li>Choose "Start in test mode" (we'll secure it later)</li>
                                            <li>Select your nearest location</li>
                                            <li>Click "Enable"</li>
                                        </ol>
                                    </div>

                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h4 className="font-semibold text-lg mb-2">Step 4: Get Your Config</h4>
                                        <ol className="list-decimal list-inside space-y-2 text-sm">
                                            <li>Click the gear icon ‚öôÔ∏è ‚Üí "Project settings"</li>
                                            <li>Scroll down to "Your apps" section</li>
                                            <li>Click "</>" (Web) icon</li>
                                            <li>Name it "GroupFit Web" and register</li>
                                            <li>Copy the firebaseConfig object shown</li>
                                        </ol>
                                    </div>

                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <h4 className="font-semibold text-lg mb-2">Step 5: Update Your Code</h4>
                                        <p className="text-sm mb-2">Replace the Firebase config in your index.html file (lines 75-82):</p>
                                        <pre className="bg-gray-800 text-white p-3 rounded text-xs overflow-x-auto">
{`const firebaseConfig = {
    apiKey: "your-actual-api-key-here",
    authDomain: "groupfit-xxxxx.firebaseapp.com",
    projectId: "groupfit-xxxxx",
    storageBucket: "groupfit-xxxxx.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abcdef"
};`}
                                        </pre>
                                    </div>

                                    <div className="bg-green-50 p-4 rounded-lg">
                                        <h4 className="font-semibold text-lg mb-2">Step 6: Deploy</h4>
                                        <ol className="list-decimal list-inside space-y-2 text-sm">
                                            <li>Save the updated index.html file</li>
                                            <li>Commit and push to GitHub</li>
                                            <li>Wait 2-5 minutes for GitHub Pages to update</li>
                                            <li>Refresh the page - you should see "‚úÖ Firebase initialized!"</li>
                                        </ol>
                                    </div>
                                </div>

                                <div className="mt-6 p-4 bg-purple-50 rounded-lg">
                                    <h4 className="font-semibold text-lg mb-2">üéâ That's it!</h4>
                                    <p className="text-sm">Once Firebase is connected, all users will see the same sessions in real-time. Messages, sessions, and user data will sync automatically across all devices!</p>
                                </div>

                                <div className="mt-4 flex justify-end">
                                    <button
                                        onClick={() => setShowSetupGuide(false)}
                                        className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
                                    >
                                        Got it!
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Authentication Component
            const AuthScreen = () => {
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                const [name, setName] = useState('');
                const [age, setAge] = useState('');
                const [city, setCity] = useState('');
                const [confirmPassword, setConfirmPassword] = useState('');
                const [showPassword, setShowPassword] = useState(false);
                const [isAuthLoading, setIsAuthLoading] = useState(false);

                const handleSignUp = async () => {
                    if (!email || !password || !name || !age || !city || !confirmPassword) {
                        showNotification('Please fill in all fields', 'error');
                        return;
                    }

                    if (!email.includes('@')) {
                        showNotification('Please enter a valid email address', 'error');
                        return;
                    }

                    if (password.length < 6) {
                        showNotification('Password must be at least 6 characters', 'error');
                        return;
                    }

                    if (password !== confirmPassword) {
                        showNotification('Passwords do not match', 'error');
                        return;
                    }

                    const ageNum = parseInt(age);
                    if (ageNum < 14 || ageNum > 19) {
                        showNotification('Age must be between 14 and 19', 'error');
                        return;
                    }

                    setIsAuthLoading(true);

                    // Get coordinates for city
                    const cityCoords = {
                        'New York': { lat: 40.7128, lng: -74.0060 },
                        'Los Angeles': { lat: 34.0522, lng: -118.2437 },
                        'Chicago': { lat: 41.8781, lng: -87.6298 },
                        'Houston': { lat: 29.7604, lng: -95.3698 },
                        'Phoenix': { lat: 33.4484, lng: -112.0740 },
                        'Philadelphia': { lat: 39.9526, lng: -75.1652 },
                        'San Antonio': { lat: 29.4241, lng: -98.4936 },
                        'San Diego': { lat: 32.7157, lng: -117.1611 },
                        'Dallas': { lat: 32.7767, lng: -96.7970 },
                        'San Jose': { lat: 37.3382, lng: -121.8863 },
                        'Austin': { lat: 30.2672, lng: -97.7431 },
                        'Seattle': { lat: 47.6062, lng: -122.3321 },
                        'Denver': { lat: 39.7392, lng: -104.9903 },
                        'Boston': { lat: 42.3601, lng: -71.0589 },
                        'Miami': { lat: 25.7617, lng: -80.1918 }
                    };
                    
                    const coords = cityCoords[city] || { lat: 40.7128, lng: -74.0060 };
                    const location = { ...coords, city };

                    if (isFirebaseEnabled) {
                        try {
                            // Create Firebase auth user
                            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                            const user = userCredential.user;

                            // Save user data to Firestore
                            await db.collection('users').doc(user.uid).set({
                                name,
                                email,
                                age: ageNum,
                                location,
                                joinedSessions: [],
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });

                            showNotification('Account created successfully!', 'success');
                        } catch (error) {
                            console.error("Signup error:", error);
                            showNotification(error.message || 'Error creating account', 'error');
                        }
                    } else {
                        // Local storage fallback
                        const newUser = {
                            id: Date.now().toString(),
                            email,
                            password,
                            name,
                            age: ageNum,
                            location,
                            joinedSessions: [],
                            createdAt: new Date().toISOString()
                        };
                        
                        const existingUsers = JSON.parse(localStorage.getItem('groupfit_users') || '[]');
                        existingUsers.push(newUser);
                        localStorage.setItem('groupfit_users', JSON.stringify(existingUsers));
                        localStorage.setItem('groupfit_current_user', JSON.stringify(newUser));
                        
                        setCurrentUser(newUser);
                        setUserLocation(location);
                        setIsLoggedIn(true);
                        showNotification('Account created successfully!', 'success');
                    }

                    setIsAuthLoading(false);
                };

                const handleLogin = async () => {
                    if (!email || !password) {
                        showNotification('Please enter email and password', 'error');
                        return;
                    }

                    setIsAuthLoading(true);

                    if (isFirebaseEnabled) {
                        try {
                            await auth.signInWithEmailAndPassword(email, password);
                            showNotification('Welcome back!', 'success');
                        } catch (error) {
                            console.error("Login error:", error);
                            showNotification(error.message || 'Invalid email or password', 'error');
                        }
                    } else {
                        // Local storage fallback
                        const users = JSON.parse(localStorage.getItem('groupfit_users') || '[]');
                        const user = users.find(u => u.email === email && u.password === password);
                        
                        if (user) {
                            localStorage.setItem('groupfit_current_user', JSON.stringify(user));
                            setCurrentUser(user);
                            if (user.location) {
                                setUserLocation(user.location);
                            }
                            setIsLoggedIn(true);
                            showNotification(`Welcome back, ${user.name}!`, 'success');
                        } else {
                            showNotification('Invalid email or password', 'error');
                        }
                    }

                    setIsAuthLoading(false);
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full fade-in">
                            <div className="text-center mb-8">
                                <i className="fas fa-users text-6xl text-blue-600 mb-4"></i>
                                <h1 className="text-4xl font-bold text-gray-800 mb-2">GroupFit</h1>
                                <p className="text-gray-600">Find Your Workout Crew</p>
                                {!isFirebaseEnabled && (
                                    <div className="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <p className="text-sm text-yellow-800">
                                            <i className="fas fa-exclamation-triangle mr-2"></i>
                                            Running in local mode. 
                                            <button 
                                                onClick={() => setShowSetupGuide(true)}
                                                className="text-blue-600 underline ml-1"
                                            >
                                                Enable online sync
                                            </button>
                                        </p>
                                    </div>
                                )}
                            </div>
                            
                            <div className="mb-6">
                                <div className="flex border-b">
                                    <button
                                        onClick={() => setIsSignUp(false)}
                                        className={`flex-1 pb-2 ${!isSignUp ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}`}
                                    >
                                        Login
                                    </button>
                                    <button
                                        onClick={() => setIsSignUp(true)}
                                        className={`flex-1 pb-2 ${isSignUp ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}`}
                                    >
                                        Sign Up
                                    </button>
                                </div>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <input
                                        type="email"
                                        placeholder="your@email.com"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>

                                {isSignUp && (
                                    <>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                            <input
                                                type="text"
                                                placeholder="John Doe"
                                                value={name}
                                                onChange={(e) => setName(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Age</label>
                                                <input
                                                    type="number"
                                                    placeholder="14-19"
                                                    min="14"
                                                    max="19"
                                                    value={age}
                                                    onChange={(e) => setAge(e.target.value)}
                                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">City</label>
                                                <select
                                                    value={city}
                                                    onChange={(e) => setCity(e.target.value)}
                                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="">Select City</option>
                                                    <option value="New York">New York</option>
                                                    <option value="Los Angeles">Los Angeles</option>
                                                    <option value="Chicago">Chicago</option>
                                                    <option value="Houston">Houston</option>
                                                    <option value="Phoenix">Phoenix</option>
                                                    <option value="Philadelphia">Philadelphia</option>
                                                    <option value="San Antonio">San Antonio</option>
                                                    <option value="San Diego">San Diego</option>
                                                    <option value="Dallas">Dallas</option>
                                                    <option value="San Jose">San Jose</option>
                                                    <option value="Austin">Austin</option>
                                                    <option value="Seattle">Seattle</option>
                                                    <option value="Denver">Denver</option>
                                                    <option value="Boston">Boston</option>
                                                    <option value="Miami">Miami</option>
                                                </select>
                                            </div>
                                        </div>
                                    </>
                                )}

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <div className="relative">
                                        <input
                                            type={showPassword ? 'text' : 'password'}
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                        <button
                                            type="button"
                                            onClick={() => setShowPassword(!showPassword)}
                                            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500"
                                        >
                                            <i className={`fas fa-eye${showPassword ? '-slash' : ''}`}></i>
                                        </button>
                                    </div>
                                </div>

                                {isSignUp && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                                        <input
                                            type={showPassword ? 'text' : 'password'}
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            value={confirmPassword}
                                            onChange={(e) => setConfirmPassword(e.target.value)}
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>
                                )}

                                <button
                                    onClick={isSignUp ? handleSignUp : handleLogin}
                                    disabled={isAuthLoading}
                                    className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isAuthLoading ? (
                                        <div className="flex items-center justify-center">
                                            <div className="loading-spinner w-5 h-5 mr-2"></div>
                                            Processing...
                                        </div>
                                    ) : (
                                        isSignUp ? 'Create Account' : 'Login'
                                    )}
                                </button>
                            </div>

                            {showSetupGuide && <FirebaseSetupGuide />}
                        </div>
                    </div>
                );
            };

            // Create Session Modal
            const CreateSessionModal = ({ onClose }) => {
                const [sessionData, setSessionData] = useState({
                    title: '',
                    exerciseType: 'running',
                    location: { ...userLocation, address: '' },
                    dateTime: '',
                    duration: 60,
                    ageRange: { min: 14, max: 19 },
                    maxParticipants: 10,
                    description: '',
                    skillLevel: 'all'
                });
                const [isCreating, setIsCreating] = useState(false);

                const handleCreate = async () => {
                    if (!sessionData.title || !sessionData.location.address || !sessionData.dateTime) {
                        showNotification('Please fill in all required fields', 'error');
                        return;
                    }

                    setIsCreating(true);

                    const newSession = {
                        ...sessionData,
                        host: {
                            id: currentUser.id,
                            name: currentUser.name,
                            email: currentUser.email
                        },
                        participants: [{
                            id: currentUser.id,
                            name: currentUser.name,
                            email: currentUser.email
                        }],
                        createdAt: new Date().toISOString()
                    };

                    if (isFirebaseEnabled) {
                        try {
                            // Add session to Firestore
                            const docRef = await db.collection('sessions').add({
                                ...newSession,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });

                            // Create chat for this session
                            await db.collection('chats').doc(docRef.id).set({
                                sessionId: docRef.id,
                                messages: []
                            });

                            // Update user's joined sessions
                            await db.collection('users').doc(currentUser.id).update({
                                joinedSessions: firebase.firestore.FieldValue.arrayUnion(docRef.id)
                            });

                            showNotification('Session created successfully!', 'success');
                            onClose();
                        } catch (error) {
                            console.error("Error creating session:", error);
                            showNotification('Error creating session. Please try again.', 'error');
                        }
                    } else {
                        // Local storage fallback
                        newSession.id = Date.now().toString();
                        setSessions([...sessions, newSession]);
                        setChats({
                            ...chats,
                            [newSession.id]: []
                        });
                        
                        currentUser.joinedSessions = [...(currentUser.joinedSessions || []), newSession.id];
                        showNotification('Session created successfully!', 'success');
                        onClose();
                    }

                    setIsCreating(false);
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 slide-in">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">Create New Session</h2>
                                <button onClick={onClose} className="text-gray-500 hover:text-gray-700">
                                    <i className="fas fa-times text-2xl"></i>
                                </button>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Session Title *</label>
                                    <input
                                        type="text"
                                        value={sessionData.title}
                                        onChange={(e) => setSessionData({...sessionData, title: e.target.value})}
                                        className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="e.g., Morning Run in Central Park"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Exercise Type *</label>
                                    <select
                                        value={sessionData.exerciseType}
                                        onChange={(e) => setSessionData({...sessionData, exerciseType: e.target.value})}
                                        className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                        {exerciseTypes.map(type => (
                                            <option key={type.id} value={type.id}>{type.name}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Location Address *</label>
                                    <input
                                        type="text"
                                        value={sessionData.location.address}
                                        onChange={(e) => setSessionData({...sessionData, location: {...sessionData.location, address: e.target.value}})}
                                        className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="e.g., Central Park, West 59th St"
                                    />
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Date & Time *</label>
                                        <input
                                            type="datetime-local"
                                            value={sessionData.dateTime}
                                            onChange={(e) => setSessionData({...sessionData, dateTime: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Duration (minutes)</label>
                                        <input
                                            type="number"
                                            value={sessionData.duration}
                                            onChange={(e) => setSessionData({...sessionData, duration: parseInt(e.target.value)})}
                                            className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Age Range</label>
                                        <div className="flex items-center space-x-2">
                                            <input
                                                type="number"
                                                min="14"
                                                max="19"
                                                value={sessionData.ageRange.min}
                                                onChange={(e) => setSessionData({...sessionData, ageRange: {...sessionData.ageRange, min: parseInt(e.target.value)}})}
                                                className="w-20 px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                            <span>to</span>
                                            <input
                                                type="number"
                                                min="14"
                                                max="19"
                                                value={sessionData.ageRange.max}
                                                onChange={(e) => setSessionData({...sessionData, ageRange: {...sessionData.ageRange, max: parseInt(e.target.value)}})}
                                                className="w-20 px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Max Participants</label>
                                        <input
                                            type="number"
                                            min="2"
                                            max="50"
                                            value={sessionData.maxParticipants}
                                            onChange={(e) => setSessionData({...sessionData, maxParticipants: parseInt(e.target.value)})}
                                            className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Skill Level</label>
                                    <select
                                        value={sessionData.skillLevel}
                                        onChange={(e) => setSessionData({...sessionData, skillLevel: e.target.value})}
                                        className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="all">All Levels</option>
                                        <option value="beginner">Beginner</option>
                                        <option value="intermediate">Intermediate</option>
                                        <option value="advanced">Advanced</option>
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea
                                        value={sessionData.description}
                                        onChange={(e) => setSessionData({...sessionData, description: e.target.value})}
                                        className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        rows="3"
                                        placeholder="Tell others what to expect..."
                                    />
                                </div>

                                <div className="flex space-x-4">
                                    <button
                                        onClick={handleCreate}
                                        disabled={isCreating}
                                        className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 disabled:opacity-50"
                                    >
                                        {isCreating ? 'Creating...' : 'Create Session'}
                                    </button>
                                    <button
                                        onClick={onClose}
                                        className="flex-1 bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-200"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Session Card Component
            const SessionCard = ({ session }) => {
                const exercise = exerciseTypes.find(e => e.id === session.exerciseType);
                const distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    session.location.lat, session.location.lng
                ).toFixed(1);
                const participants = session.participants || [];
                const isJoined = participants.some(p => p.id === currentUser.id);
                const isFull = participants.length >= session.maxParticipants;
                const sessionDate = new Date(session.dateTime);

                const handleJoin = async () => {
                    if (!isJoined && !isFull) {
                        const updatedParticipants = [...participants, {
                            id: currentUser.id,
                            name: currentUser.name,
                            email: currentUser.email
                        }];

                        if (isFirebaseEnabled) {
                            try {
                                await db.collection('sessions').doc(session.id).update({
                                    participants: updatedParticipants
                                });
                                
                                await db.collection('users').doc(currentUser.id).update({
                                    joinedSessions: firebase.firestore.FieldValue.arrayUnion(session.id)
                                });

                                showNotification(`Joined "${session.title}"!`, 'success');
                            } catch (error) {
                                console.error("Error joining session:", error);
                                showNotification('Error joining session. Please try again.', 'error');
                            }
                        } else {
                            // Local storage update
                            const updatedSessions = sessions.map(s => {
                                if (s.id === session.id) {
                                    return { ...s, participants: updatedParticipants };
                                }
                                return s;
                            });
                            setSessions(updatedSessions);
                            currentUser.joinedSessions = [...(currentUser.joinedSessions || []), session.id];
                            setCurrentUser({...currentUser});
                            showNotification(`Joined "${session.title}"!`, 'success');
                        }
                    }
                };

                const handleLeave = async () => {
                    if (isJoined && session.host.id !== currentUser.id) {
                        const updatedParticipants = participants.filter(p => p.id !== currentUser.id);

                        if (isFirebaseEnabled) {
                            try {
                                await db.collection('sessions').doc(session.id).update({
                                    participants: updatedParticipants
                                });
                                
                                await db.collection('users').doc(currentUser.id).update({
                                    joinedSessions: firebase.firestore.FieldValue.arrayRemove(session.id)
                                });

                                showNotification(`Left "${session.title}"`, 'info');
                            } catch (error) {
                                console.error("Error leaving session:", error);
                                showNotification('Error leaving session. Please try again.', 'error');
                            }
                        } else {
                            // Local storage update
                            const updatedSessions = sessions.map(s => {
                                if (s.id === session.id) {
                                    return { ...s, participants: updatedParticipants };
                                }
                                return s;
                            });
                            setSessions(updatedSessions);
                            currentUser.joinedSessions = currentUser.joinedSessions.filter(id => id !== session.id);
                            setCurrentUser({...currentUser});
                            showNotification(`Left "${session.title}"`, 'info');
                        }
                    }
                };

                return (
                    <div className="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-200 p-6 fade-in">
                        <div className="flex items-start justify-between mb-4">
                            <div className="flex items-center">
                                <div className={`${exercise.color} text-white p-3 rounded-full mr-4`}>
                                    <i className={`fas ${exercise.icon} text-xl`}></i>
                                </div>
                                <div>
                                    <h3 className="text-lg font-semibold text-gray-800">{session.title}</h3>
                                    <p className="text-sm text-gray-600">Hosted by {session.host.name}</p>
                                </div>
                            </div>
                            <div className="text-right">
                                <p className="text-sm font-medium text-blue-600">{distance} miles away</p>
                                <p className="text-xs text-gray-500">{session.location.city}</p>
                            </div>
                        </div>

                        <div className="space-y-2 mb-4">
                            <div className="flex items-center text-sm text-gray-600">
                                <i className="fas fa-calendar-alt mr-2"></i>
                                {sessionDate.toLocaleDateString()} at {sessionDate.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}
                            </div>
                            <div className="flex items-center text-sm text-gray-600">
                                <i className="fas fa-map-marker-alt mr-2"></i>
                                {session.location.address}
                            </div>
                            <div className="flex items-center text-sm text-gray-600">
                                <i className="fas fa-users mr-2"></i>
                                {participants.length}/{session.maxParticipants} participants (Ages {session.ageRange.min}-{session.ageRange.max})
                            </div>
                            <div className="flex items-center text-sm text-gray-600">
                                <i className="fas fa-clock mr-2"></i>
                                {session.duration} minutes
                            </div>
                            {session.skillLevel !== 'all' && (
                                <div className="flex items-center text-sm text-gray-600">
                                    <i className="fas fa-chart-line mr-2"></i>
                                    {session.skillLevel.charAt(0).toUpperCase() + session.skillLevel.slice(1)} level
                                </div>
                            )}
                        </div>

                        {session.description && (
                            <p className="text-sm text-gray-600 mb-4">{session.description}</p>
                        )}

                        <div className="flex space-x-2">
                            {isJoined ? (
                                <>
                                    <button
                                        onClick={() => setSelectedSession(session)}
                                        className="flex-1 bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition duration-200"
                                    >
                                        <i className="fas fa-comments mr-2"></i>
                                        Open Chat
                                    </button>
                                    {session.host.id !== currentUser.id && (
                                        <button
                                            onClick={handleLeave}
                                            className="px-4 bg-red-100 text-red-600 py-2 rounded-lg font-medium hover:bg-red-200 transition duration-200"
                                        >
                                            Leave
                                        </button>
                                    )}
                                </>
                            ) : (
                                <button
                                    onClick={handleJoin}
                                    disabled={isFull}
                                    className={`flex-1 py-2 rounded-lg font-medium transition duration-200 ${
                                        isFull 
                                            ? 'bg-gray-200 text-gray-500 cursor-not-allowed' 
                                            : 'bg-blue-600 text-white hover:bg-blue-700'
                                    }`}
                                >
                                    {isFull ? 'Session Full' : 'Join Session'}
                                </button>
                            )}
                        </div>
                    </div>
                );
            };

            // Chat Component
            const ChatModal = ({ session, onClose }) => {
                const [message, setMessage] = useState('');
                const [sessionChats, setSessionChats] = useState(chats[session.id] || []);
                const chatEndRef = useRef(null);
                const [isSending, setIsSending] = useState(false);

                useEffect(() => {
                    setSessionChats(chats[session.id] || []);
                }, [chats, session.id]);

                useEffect(() => {
                    chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
                }, [sessionChats]);

                const sendMessage = async () => {
                    if (message.trim() && !isSending) {
                        setIsSending(true);
                        const newMessage = {
                            id: Date.now().toString(),
                            sender: {
                                id: currentUser.id,
                                name: currentUser.name
                            },
                            text: message,
                            timestamp: new Date().toISOString()
                        };

                        if (isFirebaseEnabled) {
                            try {
                                await db.collection('chats').doc(session.id).update({
                                    messages: firebase.firestore.FieldValue.arrayUnion(newMessage)
                                });
                                setMessage('');
                            } catch (error) {
                                console.error("Error sending message:", error);
                                showNotification('Error sending message', 'error');
                            }
                        } else {
                            // Local storage update
                            const updatedChats = [...sessionChats, newMessage];
                            setSessionChats(updatedChats);
                            setChats({
                                ...chats,
                                [session.id]: updatedChats
                            });
                            setMessage('');
                        }
                        setIsSending(false);
                    }
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-2xl max-w-2xl w-full h-[80vh] flex flex-col slide-in">
                            <div className="flex justify-between items-center p-6 border-b">
                                <div>
                                    <h2 className="text-xl font-bold text-gray-800">{session.title}</h2>
                                    <p className="text-sm text-gray-600">{session.participants?.length || 0} members</p>
                                </div>
                                <button onClick={onClose} className="text-gray-500 hover:text-gray-700">
                                    <i className="fas fa-times text-2xl"></i>
                                </button>
                            </div>

                            <div className="flex-1 overflow-y-auto p-6 space-y-4">
                                {sessionChats.length === 0 ? (
                                    <div className="text-center text-gray-500 mt-8">
                                        <i className="fas fa-comments text-4xl mb-4"></i>
                                        <p>No messages yet. Start the conversation!</p>
                                    </div>
                                ) : (
                                    <>
                                        {sessionChats.map(msg => {
                                            const isCurrentUser = msg.sender.id === currentUser.id;
                                            return (
                                                <div key={msg.id} className={`flex ${isCurrentUser ? 'justify-end' : 'justify-start'} message-bubble`}>
                                                    <div className={`max-w-xs px-4 py-2 rounded-lg ${
                                                        isCurrentUser 
                                                            ? 'bg-blue-600 text-white' 
                                                            : 'bg-gray-200 text-gray-800'
                                                    }`}>
                                                        {!isCurrentUser && (
                                                            <p className="text-xs font-semibold mb-1">{msg.sender.name}</p>
                                                        )}
                                                        <p className="text-sm">{msg.text}</p>
                                                        <p className={`text-xs mt-1 ${isCurrentUser ? 'text-blue-100' : 'text-gray-500'}`}>
                                                            {new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}
                                                        </p>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                        <div ref={chatEndRef} />
                                    </>
                                )}
                            </div>

                            <div className="p-4 border-t">
                                <div className="flex space-x-2">
                                    <input
                                        type="text"
                                        value={message}
                                        onChange={(e) => setMessage(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && !isSending && sendMessage()}
                                        placeholder="Type a message..."
                                        className="flex-1 px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <button
                                        onClick={sendMessage}
                                        disabled={isSending}
                                        className="bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700 transition duration-200 disabled:opacity-50"
                                    >
                                        <i className="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Main App View
            const MainView = () => {
                const [showCreateModal, setShowCreateModal] = useState(false);
                const filteredSessions = getFilteredSessions();
                const joinedSessions = sessions.filter(s => 
                    s.participants?.some(p => p.id === currentUser.id)
                );

                const handleLogout = async () => {
                    if (isFirebaseEnabled) {
                        try {
                            await auth.signOut();
                            showNotification('Logged out successfully', 'info');
                        } catch (error) {
                            console.error("Logout error:", error);
                        }
                    } else {
                        localStorage.removeItem('groupfit_current_user');
                        setCurrentUser(null);
                        setIsLoggedIn(false);
                        showNotification('Logged out successfully', 'info');
                    }
                };

                return (
                    <div className="min-h-screen bg-gray-50">
                        {/* Notifications */}
                        <div className="fixed top-4 right-4 z-50 space-y-2">
                            {notifications.map(notif => (
                                <div
                                    key={notif.id}
                                    className={`px-4 py-3 rounded-lg shadow-lg text-white fade-in ${
                                        notif.type === 'error' ? 'bg-red-500' :
                                        notif.type === 'success' ? 'bg-green-500' :
                                        'bg-blue-500'
                                    }`}
                                >
                                    {notif.message}
                                </div>
                            ))}
                        </div>

                        {/* Header */}
                        <header className="bg-white shadow-sm border-b">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center">
                                        <i className="fas fa-users text-3xl text-blue-600 mr-3"></i>
                                        <h1 className="text-2xl font-bold text-gray-800">GroupFit</h1>
                                        {isFirebaseEnabled && (
                                            <span className="ml-3 bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">
                                                Online
                                            </span>
                                        )}
                                    </div>
                                    <div className="flex items-center space-x-4">
                                        {!isFirebaseEnabled && (
                                            <button
                                                onClick={() => setShowSetupGuide(true)}
                                                className="bg-yellow-100 text-yellow-700 px-4 py-2 rounded-lg hover:bg-yellow-200 transition duration-200"
                                            >
                                                <i className="fas fa-exclamation-triangle mr-2"></i>
                                                Enable Sync
                                            </button>
                                        )}
                                        <div className="text-right">
                                            <p className="text-sm font-medium text-gray-700">Welcome, {currentUser.name}</p>
                                            <p className="text-xs text-gray-500">
                                                <i className="fas fa-map-marker-alt mr-1"></i>
                                                {userLocation.city}
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => setCurrentView('mySessions')}
                                            className="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition duration-200"
                                        >
                                            <i className="fas fa-list mr-2"></i>
                                            My Sessions ({joinedSessions.length})
                                        </button>
                                        <button
                                            onClick={() => setShowCreateModal(true)}
                                            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"
                                        >
                                            <i className="fas fa-plus mr-2"></i>
                                            Create Session
                                        </button>
                                        <button
                                            onClick={handleLogout}
                                            className="bg-red-100 text-red-600 px-4 py-2 rounded-lg hover:bg-red-200 transition duration-200"
                                        >
                                            <i className="fas fa-sign-out-alt mr-2"></i>
                                            Logout
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </header>

                        {/* Filters */}
                        <div className="bg-white border-b px-4 py-4">
                            <div className="max-w-7xl mx-auto flex flex-wrap items-center gap-4">
                                <div className="flex items-center">
                                    <label className="text-sm font-medium text-gray-700 mr-2">Distance:</label>
                                    <select
                                        value={maxDistance}
                                        onChange={(e) => setMaxDistance(parseInt(e.target.value))}
                                        className="px-3 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="5">5 miles</option>
                                        <option value="10">10 miles</option>
                                        <option value="25">25 miles</option>
                                        <option value="50">50 miles</option>
                                    </select>
                                </div>

                                <div className="flex items-center">
                                    <label className="text-sm font-medium text-gray-700 mr-2">Exercise:</label>
                                    <select
                                        value={filterExercise}
                                        onChange={(e) => setFilterExercise(e.target.value)}
                                        className="px-3 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="all">All Types</option>
                                        {exerciseTypes.map(type => (
                                            <option key={type.id} value={type.id}>{type.name}</option>
                                        ))}
                                    </select>
                                </div>

                                <div className="flex items-center">
                                    <label className="text-sm font-medium text-gray-700 mr-2">Age Range:</label>
                                    <input
                                        type="number"
                                        min="14"
                                        max="19"
                                        value={filterAgeRange.min}
                                        onChange={(e) => setFilterAgeRange({...filterAgeRange, min: parseInt(e.target.value)})}
                                        className="w-16 px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <span className="mx-2">to</span>
                                    <input
                                        type="number"
                                        min="14"
                                        max="19"
                                        value={filterAgeRange.max}
                                        onChange={(e) => setFilterAgeRange({...filterAgeRange, max: parseInt(e.target.value)})}
                                        className="w-16 px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Content */}
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            {currentView === 'home' ? (
                                <>
                                    <h2 className="text-xl font-semibold text-gray-800 mb-6">
                                        Sessions Near You ({filteredSessions.length} available)
                                    </h2>
                                    {filteredSessions.length === 0 ? (
                                        <div className="text-center py-12 bg-white rounded-lg">
                                            <i className="fas fa-search text-4xl text-gray-400 mb-4"></i>
                                            <p className="text-gray-600 mb-4">No sessions found matching your criteria.</p>
                                            <button
                                                onClick={() => setShowCreateModal(true)}
                                                className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200"
                                            >
                                                Create the First Session
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            {filteredSessions.map(session => (
                                                <SessionCard key={session.id} session={session} />
                                            ))}
                                        </div>
                                    )}
                                </>
                            ) : (
                                <>
                                    <div className="flex items-center mb-6">
                                        <button
                                            onClick={() => setCurrentView('home')}
                                            className="text-blue-600 hover:text-blue-700 mr-4"
                                        >
                                            <i className="fas fa-arrow-left mr-2"></i>
                                            Back to All Sessions
                                        </button>
                                        <h2 className="text-xl font-semibold text-gray-800">
                                            My Sessions ({joinedSessions.length})
                                        </h2>
                                    </div>
                                    {joinedSessions.length === 0 ? (
                                        <div className="text-center py-12 bg-white rounded-lg">
                                            <i className="fas fa-calendar-times text-4xl text-gray-400 mb-4"></i>
                                            <p className="text-gray-600">You haven't joined any sessions yet.</p>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            {joinedSessions.map(session => (
                                                <SessionCard key={session.id} session={session} />
                                            ))}
                                        </div>
                                    )}
                                </>
                            )}
                        </div>

                        {/* Modals */}
                        {showCreateModal && (
                            <CreateSessionModal onClose={() => setShowCreateModal(false)} />
                        )}
                        {selectedSession && (
                            <ChatModal session={selectedSession} onClose={() => setSelectedSession(null)} />
                        )}
                        {showSetupGuide && <FirebaseSetupGuide />}
                    </div>
                );
            };

            // Loading Screen
            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center">
                        <div className="text-center">
                            <div className="loading-spinner mx-auto mb-4"></div>
                            <p className="text-white text-lg">Loading GroupFit...</p>
                        </div>
                    </div>
                );
            }

            // Main Render Logic
            if (!isLoggedIn) {
                return <AuthScreen />;
            }

            return <MainView />;
        };

        // Render the App
        ReactDOM.render(<GroupFitApp />, document.getElementById('root'));
    </script>
</body>
</html>
